From b486b23564bd2a28287ece15c0cfce1d6c510d57 Mon Sep 17 00:00:00 2001
From: Lin Cheng <lin_cheng@dell.com>
Date: Tue, 18 Jun 2024 08:54:41 +0000
Subject: [PATCH] src: nodejs root store add partial chain flag

---
 src/crypto/crypto_context.cc | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/src/crypto/crypto_context.cc b/src/crypto/crypto_context.cc
index 13d980c6da..0435ca1ade 100644
--- a/src/crypto/crypto_context.cc
+++ b/src/crypto/crypto_context.cc
@@ -734,6 +734,9 @@ void SecureContext::SetCACert(const BIOPointer& bio) {
     CHECK_EQ(1, X509_STORE_add_cert(cert_store, x509.get()));
     CHECK_EQ(1, SSL_CTX_add_client_CA(ctx_.get(), x509.get()));
   }
+  if (cert_store) {
+    X509_STORE_set_flags(cert_store, X509_V_FLAG_PARTIAL_CHAIN);
+  }
 }
 
 void SecureContext::AddCACert(const FunctionCallbackInfo<Value>& args) {
@@ -791,6 +794,7 @@ void SecureContext::SetRootCerts() {
 
   // Increment reference count so global store is not deleted along with CTX.
   X509_STORE_up_ref(store);
+  X509_STORE_set_flags(store, X509_V_FLAG_PARTIAL_CHAIN);
   SSL_CTX_set_cert_store(ctx_.get(), store);
 }
 
-- 
2.25.1

